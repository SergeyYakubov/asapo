<source>
 @type http
 port 9880
 bind 0.0.0.0
 add_remote_addr true
</source>

<filter asapo>
@type parser
key_name message
reserve_data true
<parse>
    @type regexp
    expression /\[(?<time>[^\]]*)\] \[(?<source>[^ ]*)\] \[(?<level>[^ ]*)\] (?<message>[^ ]*)/        
    time_key time
    time_format %Y-%m-%d %H:%M:%S.%N
  </parse>

</filter>


<match asapo>
@type copy
<store>
  @type elasticsearch
  host elastic
  port 9200
  flush_interval 5s
  logstash_format true
  time_key_format %Y-%m-%dT%H:%M:%S.%N
  time_key time
  time_key_exclude_timestamp true
  buffer_type memory
  flush_interval 1s
  </store>
  <store>
  @type file
  flush_interval 1s
  path /fluentd/etc/asapo
  </store>
</match>


